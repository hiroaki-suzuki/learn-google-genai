---
name: prd
description: "新規機能向けのプロダクト要件定義書（PRD）を生成します。新機能の企画時、新規プロジェクト開始時、またはPRD作成を依頼された際に使用してください。トリガー条件：'prdを作成'、'この機能のPRDを記述'、'この機能の企画立案'、'要件定義'、'仕様策定'"
---

# PRDジェネレーター

Ralphループを通じた自律型AI実装に適した、明確で実行可能かつ詳細なプロダクト要件定義書を作成します。

---

## 作業内容

1. ユーザーから機能仕様の説明を受け取る
2. 必須の明確化質問を3～5つ提示する（各質問にアルファベット表記の選択肢を設定）
3. 回答内容に基づいて構造化されたPRDを生成する
4. 生成したPRDを`PRD.md`ファイルに保存する
5. 空の`progress.txt`ファイルを作成する

**重要事項:** 実装作業は開始せず、あくまでPRDの作成のみを行ってください。

---

## ステップ1：明確化質問の作成

初期の指示内容が曖昧な場合に限り、重要な質問のみを尋ねてください。特に以下の点に焦点を当てます：

- **課題/目的:** この機能で解決すべき課題は何か？
- **中核機能:** 主要な動作要件は何か？
- **適用範囲/制約条件:** この機能が実行すべきでない事項は何か？
- **成功基準:** 機能が完了しているかどうかをどのように判断するか？

### 質問は以下のように形式化する：

```
1. この機能の主な目的は何ですか？
   A. ユーザーオンボーディング体験の向上
   B. ユーザー定着率の向上
   C. サポート業務負担の軽減
   D. その他：[具体的に記載]

2. 対象ユーザーは誰ですか？
   A. 新規ユーザーのみ
   B. 既存ユーザーのみ
   C. すべてのユーザー
   D. 管理者ユーザーのみ

3. 適用範囲はどのように設定しますか？
   A. 最小限の機能を備えたバージョン
   B. フル機能を実装したバージョン
   C. バックエンド/API部分のみ
   D. UI部分のみ
```

このように質問を設定することで、ユーザーは「1A、2C、3B」といった形式で迅速に回答でき、効率的な反復作業が可能になります。

---

## ステップ2：ストーリーサイズの決定（最重要ルール）

**各ストーリーは、AIが1回の作業セッション（約10分間）で完了できる規模に分割する必要があります。**

ラルフは反復ごとに新しいインスタンスを生成し、以前の作業内容を記憶しません。もしストーリーが大きすぎると、AIは作業途中でコンテキストを失い、不完全なコードを生成することになります。

### 適切なサイズのストーリー例：

- データベース列の追加とマイグレーションの実装
- 既存ページに単一のUIコンポーネントを追加
- サーバー側の処理に新しいロジックを追加
- リスト画面にフィルター用ドロップダウンを追加

### 大きすぎる場合（必ず分割が必要）：

| 大きすぎる内容                 | 分割すべき項目                                             |
| ------------------------------ | ---------------------------------------------------------- |
| "ダッシュボードを構築"         | スキーマ定義、クエリ、UIコンポーネント、フィルター機能     |
| "認証機能を追加"               | スキーマ定義、ミドルウェア、ログインUI、セッション管理     |
| "ドラッグ＆ドロップ機能を実装" | ドラッグイベント処理、ドロップゾーン、状態更新、データ保存 |
| "APIのリファクタリング"        | エンドポイントまたはパターンごとに1つのストーリーに分割    |

**基本的なルール：** 変更内容を2～3文で説明できない場合、それは大きすぎるストーリーです。

---

## ステップ3：ストーリーの順序付け（依存関係を最優先）

ストーリーは優先順位に従って実行されます。先行するストーリーは、後続のストーリーに依存してはいけません。

**正しい順序：**

1. スキーマ/データベース変更（マイグレーション処理）
2. サーバー側の処理/バックエンドロジック
3. バックエンドを利用するUIコンポーネント
4. データを集約して表示するダッシュボード/サマリービュー

**誤った順序：**

```
US-001: UIコンポーネント（まだ存在しないスキーマに依存している！）
US-002: スキーマ変更
```

---

## ステップ4：受け入れ基準の設定（検証可能なものでなければならない）

各基準は、ラルフが実際に確認できる具体的な内容でなければなりません。曖昧な表現は厳禁です。

### 適切な基準（検証可能なもの）：

- 「タスクテーブルに`status`列を追加し、デフォルト値を'pending'とする」
- 「フィルタ用ドロップダウンには、「すべて」「有効」「完了」の選択肢を表示する」
- 「削除ボタンをクリックすると確認ダイアログが表示される」
- 「型チェックが通過すること」
- 「テストがすべて合格すること」

### 不適切な基準（曖昧すぎるもの）：

- 「正しく動作する」
- 「ユーザーが簡単にX操作を行える」
- 「優れたUXを提供する」
- 「エッジケースを適切に処理する」

### 必ず最後に含めるべき基準：

```
「型チェックが通過すること」
```

### UI変更を伴うストーリーの場合は、以下も追加してください：

```
「ブラウザ上で変更が正しく反映されていることを確認する」
```

---

## PRDの構成

以下のセクション構成でPRDを作成してください：

### 1. 導入

機能の概要と、それがもたらす解決すべき課題について簡潔に説明します。

### 2. 目標

具体的で測定可能な目標を箇条書きで記載します。

### 3. ユーザーストーリー

各ストーリーには以下の要素が必要です：

- **ID：** 連番形式（例：US-001、US-002など）
- **タイトル：** 簡潔で内容が分かりやすい名称
- **説明：** 「[ユーザー種別]として、[機能]が欲しいのは[得られるメリット]のためである」
- **受け入れ基準：** 検証可能なチェックリスト

項目
**フォーマット例：**

```markdown
### US-001: [タイトル]

**説明：** [ユーザー種別]として、[機能]が欲しいのは[得られるメリット]のためである。

**受け入れ基準：**

- [ ] 検証可能な具体的な基準
- [ ] 別の基準項目
- [ ] 型チェックが通過すること
- [ ] [UI関連ストーリー] ブラウザ上で変更が正しく反映されていることを確認する
```

### 4. 対象外事項

この機能に含まれない事項を明確にします。スコープ管理において重要です。

### 5. 技術的考慮事項（任意）

- 既知の制約事項
- 再利用可能な既存コンポーネント

---

## サンプルPRD

```markdown
# PRD: タスク優先度管理システム

## 概要

タスクに優先度レベルを追加し、ユーザーが最も重要な作業に集中できるようにします。タスクは高・中・低の優先度で分類可能で、視覚的な表示とフィルタリング機能を提供します。

## 目標

- すべてのタスクに優先度（高/中/低）を割り当て可能にする
- 優先度レベルごとに明確な視覚的区別を設ける
- 優先度によるフィルタリング機能を実装する
- 新規タスクのデフォルト優先度は中程度とする

## ユーザーストーリー

### US-001: データベースに優先度フィールドを追加

**説明：** 開発者として、セッションを超えて持続するようにタスクの優先度を保存する必要がある。

\*\*
**受入基準：**

- [ ] 優先度列を追加：「高」 |「中」 |「低」（デフォルトは「中」）
- [ ] マイグレーションの生成と実行に成功する
- [ ] 型チェックが通過する

### US-002: タスクカードに優先度インジケーターを表示

**説明：** ユーザーとして、どのタスクに優先的に対応すべきかを一目で把握できるよう、タスクの優先度を視覚的に表示したい。

**受入基準：**

- [ ] 各タスクカードに色分けされた優先度バッジを表示（赤=高、黄=中、灰色=低）
- [ ] ホバー操作やクリックなしで優先度が視認できる
- [ ] 型チェックが通過する
- [ ] ブラウザ環境で変更が正しく反映されることを確認する

### US-003: タスク編集画面に優先度選択機能を追加

**説明：** ユーザーとして、タスクを編集する際にその優先度を変更できるようにしたい。

**受入基準：**

- [ ] タスク編集モーダル内に優先度選択ドロップダウンを実装
- [ ] 現在の優先度がデフォルトで選択状態に表示される
- [ ] 優先度選択を変更すると即座に保存される
- [ ] 型チェックが通過する
- [ ] ブラウザ環境で変更が正しく反映されることを確認する

### US-004: 優先度でタスクをフィルタリング可能に

**説明：** ユーザーとして、集中作業時には高優先度のタスクのみを表示するよう、タスクリストをフィルタリングできるようにしたい。

**受入基準：**

- [ ] フィルタドロップダウンに「すべて」|「高」|「中」|「低」のオプションを実装
- [ ] フィルタ設定がURLパラメータに保持される
- [ ] フィルタ条件に一致するタスクがない場合の空状態メッセージを表示する
- [ ] 型チェックが通過する
- [ ] ブラウザ環境で変更が正しく反映されることを確認する

## 対象外項目

- 優先度に基づく通知やリマインダー機能は実装しない
- 期限日に基づいて自動的に優先度が割り当てられる機能は実装しない
- サブタスクに対する親タスクの優先度継承機能は実装しない

## 技術的考慮事項

- 既存のバッジコンポーネントを色バリエーション付きで再利用する
- フィルタ状態はURLの検索パラメータで管理する
```

---

## 出力内容

現在のディレクトリに`PRD.md`として保存すること。

併せて`progress.txt`も作成すること：

```markdown
# 進捗記録

## 得られた知見

（実装過程で発見されたパターンや知見）

---
```

---

## 保存前のチェックリスト

- [ ] 質問事項をアルファベット順の選択肢形式で明確に提示したか
- [ ] ユーザーからの回答を適切に反映したか
- [ ] ユーザーストーリーはUS-001形式に準拠しているか
- [ ] 各ストーリーは1イテレーション内で完了可能な規模か（小さすぎないか）
- [ ] ストーリーは依存関係順に整理されているか（スキーマ→バックエンド→フロントエンドの順）
- [ ] すべての要件が検証可能なものか（曖昧な表現がないか）
- [ ] 各ストーリーに「型チェック通過」を検証基準として設定しているか
- [ ] UI関連のストーリーには「ブラウザで変更が正しく動作することを確認」を検証基準として設定しているか
- [ ] 対象外項目セクションで明確な境界を定義しているか
- [ ] PRD.mdとprogress.txtの両方を保存したか
