# PRD: 映画メタ情報品質評価システムの環境変数化対応

## 概要

現在ハードコーディングされている品質評価の閾値を環境変数で管理できるようにし、本番環境とテスト環境で異なる閾値を使用可能にします。これにより、環境ごとの閾値調整が容易になり、テストの信頼性も向上します。

## 目標

- 品質スコアの閾値をハードコードから環境変数管理に移行する
- 本番用とテスト用で異なる環境変数ファイル（.env、.env.test）を作成する
- ENV環境変数による環境切り替え機構を実装する
- 単体テストで.env.testが自動的に読み込まれるようにする

## ユーザーストーリー

### US-001: 環境変数ファイルの作成

**説明：** 開発者として、本番環境とテスト環境で異なる閾値を管理できるよう、環境変数ファイルを整備したい。

**受け入れ基準：**

- [ ] `.env`ファイルに本番用の品質スコア閾値を定義する（例：QUALITY_SCORE_THRESHOLD=0.8）
- [ ] `.env.test`ファイルにテスト用の品質スコア閾値を定義する（例：QUALITY_SCORE_THRESHOLD=0.5）
- [ ] `.env.example`ファイルに設定例とコメントを記載する
- [ ] 各ファイルで設定する環境変数名が統一されている
- [ ] 品質チェック（フォーマット、Lint、型チェック）が通過すること

### US-002: 環境変数読み込みロジックの実装

**説明：** 開発者として、ENV環境変数の値に基づいて適切な環境変数ファイルを読み込めるようにしたい。

**受け入れ基準：**

- [ ] ENV環境変数が"test"の場合、`.env.test`を読み込む
- [ ] ENV環境変数が未設定または"production"の場合、`.env`を読み込む
- [ ] 環境変数ファイルが存在しない場合、適切なエラーメッセージを表示する
- [ ] 環境変数の読み込み処理を専用の関数またはモジュールに実装する
- [ ] 品質チェック（フォーマット、Lint、型チェック）が通過すること
- [ ] テストがすべて合格すること
- [ ] テストカバレッジが基準値を満たすこと

### US-003: ハードコードされた閾値の置き換え

**説明：** 開発者として、コード内にハードコーディングされている品質スコア閾値を環境変数参照に置き換えたい。

**受け入れ基準：**

- [ ] 品質評価ロジック内のハードコードされた閾値を環境変数から取得するよう変更する
- [ ] 環境変数が未設定の場合のデフォルト値を設定する（例：0.8）
- [ ] 環境変数の値が不正な場合（数値以外、範囲外など）の例外処理を実装する
- [ ] 変更後もロジックの動作が既存と同じであることを確認する
- [ ] 品質チェック（フォーマット、Lint、型チェック）が通過すること
- [ ] テストがすべて合格すること
- [ ] テストカバレッジが基準値を満たすこと

### US-004: 単体テストの環境変数設定

**説明：** 開発者として、単体テスト実行時に自動的に.env.testが読み込まれるようにしたい。

**受け入れ基準：**

- [ ] テスト実行時にENV=testが設定されるよう、テスト設定ファイル（pytest.ini等）を更新する
- [ ] 既存のテストがすべて.env.testの閾値で正常に動作することを確認する
- [ ] テスト実行時に.envではなく.env.testが読み込まれていることをログまたはアサーションで確認する
- [ ] テストコマンド実行時の環境変数設定方法をREADMEまたはドキュメントに記載する
- [ ] 品質チェック（フォーマット、Lint、型チェック）が通過すること
- [ ] テストがすべて合格すること
- [ ] コンソール出力で.env.testが正しく読み込まれていることを確認する

## 対象外項目

- 品質スコア以外の設定値の環境変数化は実施しない
- 統合テストやE2Eテスト用の環境変数設定は対象外
- クラウド環境（AWS Secrets Manager等）への設定値移行は実施しない
- 環境変数の動的な変更や再読み込み機能は実装しない
- 環境変数設定用のGUIやCLIツールは提供しない

## 技術的考慮事項

- `uv`が自動的に`.env`ファイルを読み込む仕様を活用する
- ENV環境変数の設定は、テスト実行時のコマンドまたはpytest設定で行う
- 環境変数の型変換（文字列→数値）とバリデーション処理を適切に実装する
- 既存のコード構造を可能な限り維持し、最小限の変更で実現する
